# Bridge Runtime Handler Configuration Schema
# Version: 1.0.0-alpha
# Documentation: https://github.com/kswhitlock9493-jpg/SR-AIbridge-/docs/BRH_GUIDE.md

version: "1.0"
runtime:
  name: "sr-aibridge-runtime"
  type: "sovereign"  # sovereign | federated | replica
  
  # Forge Dominion Integration
  auth:
    provider: "forge_dominion"
    token_mode: "ephemeral"  # ephemeral | static (deprecated)
    token_ttl: 3600  # seconds (1 hour default)
    auto_renew: true
    
  # Container/Process Configuration
  containers:
    - name: "backend-api"
      image: "python:3.12-slim"
      command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
      environment:
        - FORGE_DOMINION_MODE=sovereign
        - DATABASE_TYPE=sqlite
      ports:
        - "8000:8000"
      health_check:
        path: "/health"
        interval: 30
        timeout: 5
        retries: 3
      resources:
        memory: "512Mi"
        cpu: "0.5"
        
    - name: "frontend-static"
      image: "nginx:alpine"
      command: ["nginx", "-g", "daemon off;"]
      ports:
        - "3000:80"
      health_check:
        path: "/"
        interval: 30
        timeout: 5
        retries: 3
      resources:
        memory: "256Mi"
        cpu: "0.25"
  
  # Service Routes
  routes:
    - path: "/api/*"
      target: "backend-api:8000"
      strip_prefix: "/api"
    - path: "/*"
      target: "frontend-static:80"
  
  # Lifecycle Management
  lifecycle:
    startup_timeout: 120
    shutdown_timeout: 30
    restart_policy: "on-failure"
    max_restarts: 3
    
  # Federation Configuration (μ-harmonic lattice)
  federation:
    enabled: true
    lattice_mode: "harmonic"
    heartbeat_interval: 10  # seconds
    sync_protocol: "μ-state-replication"
    
  # Logging and Metrics
  observability:
    logs:
      destination: "forge://sovereign-ledger/runtime"
      level: "info"
      format: "json"
    metrics:
      enabled: true
      destination: "forge://metrics/runtime"
      interval: 60  # seconds
    
# Deployment Targets
deploy:
  # GitHub Actions Integration
  github:
    workflow: "bridge_deploy.yml"
    trigger: "push"
    branches: ["main", "staging"]
    
  # Multi-target support
  targets:
    - name: "production"
      provider: "bridge_runtime_handler"
      region: "auto"
      replicas: 2
    - name: "staging"
      provider: "bridge_runtime_handler"
      region: "auto"
      replicas: 1

# Security Configuration
security:
  # Forge Dominion seal
  attestation:
    enabled: true
    seal_algorithm: "HMAC-SHA256"
    
  # Network policies
  network:
    ingress:
      - port: 8000
        protocol: "HTTP"
      - port: 3000
        protocol: "HTTP"
    egress:
      - destination: "forge://dominion"
        protocol: "HTTPS"
      - destination: "*.github.com"
        protocol: "HTTPS"
