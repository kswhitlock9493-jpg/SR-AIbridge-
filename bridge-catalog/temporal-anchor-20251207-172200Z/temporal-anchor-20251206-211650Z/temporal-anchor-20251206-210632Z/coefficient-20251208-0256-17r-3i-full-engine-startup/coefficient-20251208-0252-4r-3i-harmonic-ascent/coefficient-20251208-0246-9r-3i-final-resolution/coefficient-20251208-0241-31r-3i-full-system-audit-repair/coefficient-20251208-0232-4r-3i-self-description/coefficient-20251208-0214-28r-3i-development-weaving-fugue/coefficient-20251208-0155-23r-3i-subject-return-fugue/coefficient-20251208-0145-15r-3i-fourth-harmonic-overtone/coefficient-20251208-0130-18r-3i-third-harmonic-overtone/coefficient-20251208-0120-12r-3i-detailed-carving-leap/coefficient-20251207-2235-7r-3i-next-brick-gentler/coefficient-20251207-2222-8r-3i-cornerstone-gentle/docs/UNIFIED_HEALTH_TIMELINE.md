# Unified Health Timeline - Operation Synchrony

## Overview

The Unified Health Timeline brings together CI/CD, Endpoint, and API triage systems into a single, real-time diagnostics timeline. Every triage event flows through one unified endpoint, providing a full-system snapshot at a glance.

## Architecture

### Components

1. **Synchrony Collector** (`bridge_backend/scripts/synchrony_collector.py`)
   - Collects and merges triage reports from multiple sources
   - Generates `unified_timeline.json` with all events sorted by timestamp
   - Supports: CI/CD, Endpoint, and API triage reports

2. **CI/CD Triage Generator** (`bridge_backend/scripts/ci_cd_triage.py`)
   - Generates CI/CD deployment and build status reports
   - Captures deployment success/failure events
   - Integrates with GitHub Actions workflows

3. **Unified Timeline API** (`/api/diagnostics/timeline/unified`)
   - REST endpoint that serves the merged timeline
   - Auto-builds timeline if it doesn't exist
   - Returns all events sorted by timestamp (newest first)

4. **Frontend Component** (`bridge-frontend/src/components/UnifiedHealthTimeline.jsx`)
   - Displays unified health feed with color-coded status
   - Auto-refreshes every 60 seconds
   - Shows event type, status, source, and timestamp

5. **GitHub Actions Workflow** (`.github/workflows/unified-health.yml`)
   - Triggers after endpoint, API, or deploy workflows complete
   - Rebuilds unified timeline
   - Uploads artifacts and syncs to Bridge

## Event Types

The unified timeline supports the following event types:

| Event Type | Icon | Source | Description |
|-----------|------|--------|-------------|
| `CI_CD_TRIAGE` | ‚öôÔ∏è | ci_cd_triage.py | CI/CD pipeline health check |
| `ENDPOINT_TRIAGE` | ü©∫ | endpoint_triage.py | Backend endpoint health check |
| `API_TRIAGE` | üß¨ | api_triage.py | API schema validation check |
| `DEPLOYMENT_SUCCESS` | üöÄ | GitHubAction | Successful deployment |
| `DEPLOYMENT_FAILURE` | üî• | GitHubAction | Failed deployment |
| `DEPLOYMENT_RECOVERY` | üíö | GitHubAction | Recovery from deployment failure |
| `DEPLOYMENT_REPAIR` | ü©π | GitHubAction | Auto-repair of deployment |
| `BUILD_SUCCESS` | üß± | GitHubAction | Successful build |
| `BUILD_FAILURE` | üí• | GitHubAction | Failed build |

## Status Levels

- **HEALTHY**: All systems operational
- **DEGRADED**: Some components failing, system still operational
- **CRITICAL**: Multiple failures, system may be impaired
- **success**: Operation completed successfully
- **failed**: Operation failed
- **auto-healed**: System automatically recovered

## Usage

### Manual Timeline Generation

```bash
cd bridge_backend
python3 scripts/synchrony_collector.py
```

This will:
1. Look for `endpoint_report.json`, `api_triage_report.json`, and `ci_cd_report.json`
2. Merge them into `unified_timeline.json`
3. Sort by timestamp (newest first)

### API Endpoint

**GET** `/api/diagnostics/timeline/unified`

Returns:
```json
{
  "count": 3,
  "events": [
    {
      "type": "DEPLOYMENT_SUCCESS",
      "status": "success",
      "source": "ci_cd_triage.py",
      "meta": {
        "timestamp": "2025-10-07T12:11:42.630608+00:00",
        "environment": "CI/CD",
        "trigger": "GitHubAction",
        "details": {}
      }
    },
    ...
  ]
}
```

### Frontend Integration

Import and use the `UnifiedHealthTimeline` component:

```jsx
import UnifiedHealthTimeline from './components/UnifiedHealthTimeline';

function Dashboard() {
  return (
    <div>
      <UnifiedHealthTimeline />
    </div>
  );
}
```

The component will:
- Fetch timeline on mount
- Auto-refresh every 60 seconds
- Display events with color-coded status
- Show event icons, timestamps, and status

### Automated Workflow

The unified health timeline automatically rebuilds after:
1. Endpoint Triage workflow completes
2. API Triage workflow completes
3. Build & Deploy workflow completes

## Event Flow

```
1. Triage Scripts Generate Reports
   ‚îú‚îÄ‚îÄ endpoint_triage.py ‚Üí endpoint_report.json
   ‚îú‚îÄ‚îÄ api_triage.py ‚Üí api_triage_report.json
   ‚îî‚îÄ‚îÄ ci_cd_triage.py ‚Üí ci_cd_report.json

2. Synchrony Collector Merges Reports
   ‚îî‚îÄ‚îÄ synchrony_collector.py ‚Üí unified_timeline.json

3. Unified Timeline Workflow
   ‚îú‚îÄ‚îÄ Triggers after triage workflows
   ‚îú‚îÄ‚îÄ Rebuilds unified_timeline.json
   ‚îî‚îÄ‚îÄ Uploads to Bridge API

4. Frontend Displays Timeline
   ‚îî‚îÄ‚îÄ UnifiedHealthTimeline.jsx fetches and displays events
```

## Integration Points

1. **Triage Scripts**: All triage scripts save their reports to JSON files
2. **Collector Script**: Merges JSON files into unified timeline
3. **API Endpoint**: Serves unified timeline via REST API
4. **GitHub Actions**: Automates timeline rebuild after workflows
5. **Frontend**: Displays timeline in Bridge dashboard

## Configuration

### Required Files

The synchrony collector looks for these files in the `bridge_backend` directory:
- `endpoint_report.json` (generated by `endpoint_triage.py`)
- `api_triage_report.json` (generated by `api_triage.py`)
- `ci_cd_report.json` (generated by `ci_cd_triage.py`)

### .gitignore

All triage reports are excluded from git:
```
endpoint_report.json
api_triage_report.json
ci_cd_report.json
unified_timeline.json
```

## Troubleshooting

### Timeline Not Building

1. Check that triage scripts are running and generating reports
2. Verify reports exist in `bridge_backend` directory
3. Run collector manually to see error messages

```bash
cd bridge_backend
python3 scripts/synchrony_collector.py
```

### API Endpoint Returns Empty Timeline

1. Check if `unified_timeline.json` exists
2. Verify collector script has executed successfully
3. Check FastAPI logs for errors

### Frontend Not Showing Events

1. Verify `/api/diagnostics/timeline/unified` endpoint is accessible
2. Check browser console for fetch errors
3. Ensure backend is running and accessible
4. Verify unified timeline has been generated

### Workflow Not Triggering

1. Check that required workflows are completing
2. Verify workflow names match exactly in `unified-health.yml`
3. Check GitHub Actions logs for errors

## Security Considerations

- Timeline data is public within the application
- No sensitive information should be included in triage reports
- BRIDGE_URL secret required for workflow integration
- API endpoint has no authentication (internal use only)

## Future Enhancements

- [ ] Real-time WebSocket updates instead of polling
- [ ] Filter timeline by event type or status
- [ ] Export timeline as CSV or PDF
- [ ] Email/Slack notifications for critical events
- [ ] Historical timeline with date range filters
- [ ] Event aggregation and trend analysis
- [ ] Custom event type registration
