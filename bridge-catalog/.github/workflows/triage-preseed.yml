name: Triage Pre-Seed
on:
  workflow_dispatch:

jobs:
  preseed:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install Dependencies
        run: |
          cd bridge_backend
          pip install requests
      
      - name: Generate Baseline Reports
        run: |
          cd bridge_backend
          python3 scripts/triage_preseed.py
      
      - name: Upload Baseline to Bridge
        run: |
          curl -X POST "${{ secrets.BRIDGE_URL }}/api/diagnostics" \
            -H "Content-Type: application/json" \
            -d @bridge_backend/unified_timeline.json || echo "Bridge notification skipped (URL not configured)"
      
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: preseed-reports
          path: |
            bridge_backend/endpoint_report.json
            bridge_backend/api_triage_report.json
            bridge_backend/hooks_triage_report.json
            bridge_backend/ci_cd_report.json
            bridge_backend/unified_timeline.json
          retention-days: 7
