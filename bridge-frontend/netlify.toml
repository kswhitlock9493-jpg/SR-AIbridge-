# ==========================================================
# üåâ Sovereign Bridge ‚Äî Netlify Runtime Configuration
# ==========================================================
# Handles UI builds, Forge handshake triggers, and Dominion sync.
# ==========================================================

[build]
  base = "bridge-frontend"
  command = "npm run build && python3 ../bridge_backend/forge/export_runtime.py"
  publish = "bridge-frontend/dist"

[functions]
  directory = "bridge-frontend/netlify/functions"

# ==========================================================
# üîó Environment Linking (Forge Dominion)
# ==========================================================
# Passes the Sovereign Dominion Root to build-time context.
# FORGE_DOMINION_ROOT is managed by GitHub Secrets and injected automatically.

[context.production.environment]
  FORGE_DOMINION_ROOT = "dominion://sovereign.bridge?env=${GITHUB_REF_NAME}&epoch=$(date +%s)&sig=${DOMINION_SEAL}"

[context.deploy-preview.environment]
  FORGE_DOMINION_ROOT = "dominion://sovereign.bridge?env=preview-${GITHUB_REF_NAME}&epoch=$(date +%s)&sig=${DOMINION_SEAL}"

[context.branch-deploy.environment]
  FORGE_DOMINION_ROOT = "dominion://sovereign.bridge?env=branch-${GITHUB_REF_NAME}&epoch=$(date +%s)&sig=${DOMINION_SEAL}"

# ==========================================================
# ‚öôÔ∏è Redirect Rules (API Federation)
# ==========================================================
# Automatically redirects API calls to Forge Dominion Runtime.

[[redirects]]
  from = "/api/*"
  to = "https://forge-dominion.bridge/api/:splat"
  status = 200

# ==========================================================
# ü™∂ Webhook Notifications (Bridge Runtime Heartbeat)
# ==========================================================
# Used for deploy lifecycle signals to the Forge Handshake.

[[plugins]]
  package = "@netlify/plugin-deploy-notifications"

[[plugins.inputs]]
  webhook_url = "https://sovereign.bridge/api/forge/deploy"
  secret = "${DOMINION_SEAL}"
