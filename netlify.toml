# ==========================================
# SR-AIbridge Netlify Configuration (v1.7.9)
# ==========================================

[build]
  base    = "bridge-frontend"
  command = "npm run ci:install && npm run build"
  publish = "bridge-frontend/dist"
  functions = "bridge-frontend/netlify/functions"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--no-audit --prefer-offline"
  NPM_CONFIG_PRODUCTION = "false"
  # Calm secret scan noise but keep it on:
  SECRETS_SCAN_LOG_LEVEL = "error"
  # Healer-Net toggles
  AUTO_REPAIR_MODE = "true"
  BRIDGE_HEALTH_REPORT = "enabled"
  DIAGNOSTIC_KEY = "sr-dx-prod-bridge-001"
  CONFIDENCE_MODE = "enabled"
  # Existing environment variables
  VITE_API_BASE = "https://sr-aibridge.onrender.com"
  REACT_APP_API_URL = "https://sr-aibridge.onrender.com"
  CASCADE_MODE = "active"
  BRIDGE_API_URL = "https://sr-aibridge.onrender.com"
  VAULT_URL = "https://vault.sr-aibridge.com"
  PUBLIC_API_BASE = "https://sr-aibridge.onrender.com"
  PUPPETEER_SKIP_DOWNLOAD = "true"
  PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD = "true"
  CHROMIUM_DOWNLOAD_ALLOWED = "false"
  PUPPETEER_CACHE_DIR = "/opt/buildhome/.cache/puppeteer"
  PLAYWRIGHT_BROWSERS_PATH = "/opt/buildhome/.cache/ms-playwright"
  CHROMIUM_CHANNEL = "stable"

# SPA routing
[[redirects]]
  from = "/*"
  to   = "/index.html"
  status = 200

# Build image hint (optional, keeps consistency)
[build.images]
  node = "20"

